#include <stdio.h>
#include "ch8.h"
#include "ch8_internal.h"

#define CH8_FONT_SIZE 80

static const uint8_t ch8_font[CH8_FONT_SIZE] = {
    0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
    0x20, 0x60, 0x20, 0x20, 0x70, // 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
    0x90, 0x90, 0xF0, 0x10, 0x10, // 4
    0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
    0xF0, 0x10, 0x20, 0x40, 0x40, // 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
    0xF0, 0x90, 0xF0, 0x90, 0x90, // A
    0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
    0xF0, 0x80, 0x80, 0x80, 0xF0, // C
    0xE0, 0x90, 0x90, 0x90, 0xE0, // D
    0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
    0xF0, 0x80, 0xF0, 0x80, 0x80  // F
};

void ch8_load_font(uint8_t *mem)
{
    uint8_t i;
    for (i = 0; i < CH8_FONT_SIZE; i++) {
        mem[CH8_FONT_START + i] = ch8_font[i];
    }
}

size_t ch8_load_program(ch8_t *ch8, const char *path)
{
    FILE *program_file = fopen(path, "rb");

    if (!program_file)
        return 0;

    size_t filesize_max = CH8_MEMORY_SIZE - CH8_PROGRAM_START;
    size_t bytes_read = fread(
        &ch8->mem[CH8_PROGRAM_START],
        sizeof (uint8_t),
        filesize_max,
        program_file
    );

    fclose(program_file);

    return bytes_read;
}
